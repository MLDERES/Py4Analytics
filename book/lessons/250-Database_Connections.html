
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Working with relational database</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="www.py4analytics.info/book/lessons/250-Database_Connections.html" />
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Exploratory Data Analysis" href="260-Data_Visualization.html" />
    <link rel="prev" title="Gather data from the web" href="240-Getting_Web_Data.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-NZH9210CF9"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-NZH9210CF9');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Python For Analytics
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01-JupyterNotebooks.html">
   Welcome to Jupyter Notebooks
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Part 1 - Python Basics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="100-PartOne.html">
   Part 1 - Basic Python
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="110-Introduction.html">
     Learning to program
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="120-Flow_Control.html">
     Making Decisions &amp; Looping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="130-Functions.html">
     Reusing Code
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="TryIt_Part1.html">
   Exercises
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../exercises/110-Introduction-ex.html">
     Try it: Getting Started with Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../exercises/120-Flow_Control-ex.html">
     Try it: Flow Control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../exercises/130-Functions-ex.html">
     Try it: Functions
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Part 2 - Intermediate Concepts
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="200-PartTwo.html">
   Part 2 - Intermediate Concepts
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="210-Object_Orientation.html">
     Namespace, Objective Orientation and Packaging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="220-Data_Manipulation.html">
     Working with data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="230-Web_Data.html">
     Differing data formats
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="240-Getting_Web_Data.html">
     Gather data from the web
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Working with relational database
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="260-Data_Visualization.html">
     Exploratory Data Analysis
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="TryIt_Part2.html">
   Exercises
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../exercises/210-Object_Orientation-ex.html">
     Try it: Objects, Namespaces and Packages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../exercises/220-Data_Manipulation-ex.html">
     Try it: Manipulating Data With pandas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../exercises/230-Web_Data-ex.html">
     Try it: Working with common data formats
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../exercises/240-Getting_Web_Data-ex.html">
     Try it: Getting data from the web
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../exercises/250-Database_Connections-ex.html">
     Try-it: Connecting to a Database
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../exercises/260-Data_Visualization-ex.html">
     Try it: Data Visualization
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Part 3
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="300-PartThree.html">
   Part 3 - Using Python for Machine Learning
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="310-ExploratoryDataAnalysis.html">
     Exploratory Data Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="311-OtherToolsForEDA.html">
     Other tools for Data Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="312-VisualizationSamples.html">
     Visualization Examples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="320-DataPreparation.html">
     Data Preparation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="330-Classification.html">
     Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="335-ClassificationSolutions.html">
     Automobile Accidents
     <a id="auto-accidents">
     </a>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="340-EstimationPrediction.html">
     Prediction and Estimation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="341-AdvancedTechniques.html">
     Advanced Techniques
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="342-Pipelines.html">
     Pipelines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="343-Ensembling.html">
     Ensembling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="345-EstimationPredictionExample.html">
     Predicting the price of used cars
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="350-Unsupervised.html">
     Unsupervised Data Mining
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="360-NeuralNetworks.html">
     Neural Networks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="VisualizationSamples.html">
     Visualization Samples
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="TryIt_Part3.html">
   Exercises
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../exercises/310-ExploratoryDataAnalysis-ex.html">
     Try It: Exploratory Data Analysis
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Appendix
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../exercises/Coding_Challenges.html">
   Coding Challenges
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../extras/00-extras.html">
   Extras
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../extras/251-SQL_Alchemy.html">
     Using an Object Relational Mapping Database
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../extras/252-SQL_ODBC.html">
     Connecting to MS SQL using ODBC
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            <div>
  Last Update: Tue Oct 25 21:12:50 2022
</div>

            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/mlderes/Py4Analytics/main?urlpath=lab/tree/book/lessons/250-Database_Connections.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://isys5103-uark.msappproxy.net/hub/user-redirect/git-pull?repo=https%3A//github.com/mlderes/Py4Analytics&urlpath=lab/tree/Py4Analytics/book/lessons/250-Database_Connections.ipynb&branch=main"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on JupyterHub"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_jupyterhub.svg">
  </span>
<span class="headerbtn__text-container">JupyterHub</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/mlderes/Py4Analytics"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/mlderes/Py4Analytics/issues/new?title=Issue%20on%20page%20%2Fbook/lessons/250-Database_Connections.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/book/lessons/250-Database_Connections.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#definitions">
   Definitions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-run-a-query">
   How to run a query
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sqlite3">
   SQLITE3
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#connecting-to-other-rdbms">
   Connecting to other RDBMS
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#connecting-to-ms-sql-server">
     Connecting to MS SQL Server
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dynamic-queries">
     Dynamic Queries
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#passing-parameters">
       Passing parameters
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-pandas">
   Using pandas
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Working with relational database</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#definitions">
   Definitions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-run-a-query">
   How to run a query
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sqlite3">
   SQLITE3
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#connecting-to-other-rdbms">
   Connecting to other RDBMS
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#connecting-to-ms-sql-server">
     Connecting to MS SQL Server
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dynamic-queries">
     Dynamic Queries
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#passing-parameters">
       Passing parameters
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-pandas">
   Using pandas
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="working-with-relational-database">
<h1>Working with relational database<a class="headerlink" href="#working-with-relational-database" title="Permalink to this headline">#</a></h1>
<p>One common source of data, especially in institutions, is a relational database.  Microsoft SQL Server, Teradata, Oracle, Postgres, MySql are all examples of relational databases that are in common use for managing transactional data.  Storing and retrieving data from these servers is a regular task in the life of an analyst because any process that does anything interesting is likely to generate or ingest a lot of data.  In this notebook, we’ll look at the main components of a database connection, how to establish a connection and put some data into a simple database and read some data out the database.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>SQL (pronounced S-Q-L or see-kwil) is the primary data manipulation language. This means SQL is the language we use to get/save data with a relational database.  You won’t need an in-depth understanding of SQL to work through this notebook, but if you want to brush up on some of the basics, this is <a class="reference external" href="https://www.w3schools.com/sql/default.asp">a good resources</a>.</p>
</div>
<section id="definitions">
<h2>Definitions<a class="headerlink" href="#definitions" title="Permalink to this headline">#</a></h2>
<p>Before we start, let’s define a few terms generically so that when you see them it becomes more clear what is happening.</p>
<ul class="simple">
<li><p><strong>Database Server</strong> - A database server is the hardware which runs database software.  We will often refer to the database server as both the hardware and the software together.</p></li>
<li><p><strong>Database</strong> - A database is a collection of tables, functions, procedures, et al, which allow access to the actual data.  The distinction between the server and the database are an important distinction, as a single <em>database server</em> can be hosting many <em>databases</em>.</p></li>
<li><p><strong>Connection</strong> - in order to be able to run queries on a particular database, the client software needs to establish a connection to the database server/database combination.</p></li>
<li><p><strong>Cursor</strong> - A database <a class="reference external" href="https://en.wikipedia.org/wiki/Cursor_(databases)">cursor</a> is a mechanism which allows us to traverse the records in the database.  We can have many different cursors using the same connection to the database.</p></li>
</ul>
</section>
<section id="how-to-run-a-query">
<h2>How to run a query<a class="headerlink" href="#how-to-run-a-query" title="Permalink to this headline">#</a></h2>
<p>There are a few basic steps in order to execute a query against a relational database.</p>
<ol class="simple">
<li><p>Establish a connection to the database</p></li>
<li><p>Using the connection create a cursor upon which to execute one or more SQL commands</p></li>
<li><p>Execute the SQL command using the cursor</p></li>
<li><p>Assuming there is a result, process the results of the query</p></li>
<li><p>The cursor may be reused if there are more commands to run</p></li>
<li><p>When the operation is complete, close the connection</p></li>
</ol>
<p>We are going to look at a few different approaches for making the connection to the database.  Which one you use will depend largely on the destination RDBMS server.  For instance some of the common protocols include ODBC, OLE-DB, and DBAPI.  We’ll take a look at a couple of these here.</p>
</section>
<section id="sqlite3">
<h2>SQLITE3<a class="headerlink" href="#sqlite3" title="Permalink to this headline">#</a></h2>
<p>Arguably one of the simplest relational databases to work with in is the <a class="reference external" href="https://www.sqlite.org/index.html">SQLite3</a> database.  It is also one of the most used databases in the world.  It’s built into every <a class="reference external" href="https://www.sqlite.org/mostdeployed.html">mobile phone</a> and comes bundled in many applications people use on a regular basis.  It has many of the features of a more robust relational database, though the data is all stored in a single portable file format.</p>
<p>Before we make a connection and read from a SQLite database, we need to describe cursors.  A database <a class="reference external" href="https://en.wikipedia.org/wiki/Cursor_(databases)">cursor</a> is a mechanism which allows us to traverse the records in the database.  You can think of it as a pointer to a record.  We’ll use a cursor in the next example to get data from a predefined database.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>If you get an error running the next cell, it’s likely that their is a database file already in the <code class="docutils literal notranslate"><span class="pre">output</span></code> folder.  In order to resolve, either delete the file <code class="docutils literal notranslate"><span class="pre">sample.db</span></code> or rename it to something like <code class="docutils literal notranslate"><span class="pre">sample.db.bak</span></code></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="c1"># Make a connection to the database</span>
<span class="n">cnn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;../output/sample.db&#39;</span><span class="p">)</span>

<span class="c1"># Next make a cursor that can be used to run a query on the new connection</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">cnn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># Now we can execute our SQL statement against the database</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;CREATE TABLE pet(name , breed, owner)&#39;</span><span class="p">,)</span>

<span class="c1"># Now we&#39;ll check to see if the data was made.</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT name FROM sqlite_master&#39;</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;pet&#39;,)
</pre></div>
</div>
</div>
</div>
<p>We’ll next insert a bit of data into our database to make it a little more interesting.  This is not a lesson on SQLite per se, for that I would point you to the <a class="reference external" href="https://docs.python.org/3/library/sqlite3.html">documentation</a>.  But it should be noted that SQLite requires that transactions which intend to change to the database must be committed.  If you are unfamiliar with transactions, then you can brush up <a class="reference external" href="https://en.wikipedia.org/wiki/Database_transaction">here</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot; </span>
<span class="s2">    INSERT INTO pet VALUES</span>
<span class="s2">        (&#39;Sparky&#39;, &#39;goldfish&#39;, &#39;Jim&#39;),</span>
<span class="s2">        (&#39;Buster&#39;,&#39;terrier&#39;,&#39;Louise&#39;),</span>
<span class="s2">        (&#39;T-Rex&#39;,&#39;iguana&#39;,&#39;Caleb&#39;)</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="p">)</span>
<span class="c1"># Make the changes to the database</span>
<span class="n">cnn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now let&#39;s get the data back out</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM pet&#39;</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

<span class="c1"># When we are finally done, we want to be sure to close the connection.</span>
<span class="n">cnn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;Sparky&#39;, &#39;goldfish&#39;, &#39;Jim&#39;),
 (&#39;Buster&#39;, &#39;terrier&#39;, &#39;Louise&#39;),
 (&#39;T-Rex&#39;, &#39;iguana&#39;, &#39;Caleb&#39;),
 (&#39;Sparky&#39;, &#39;goldfish&#39;, &#39;Jim&#39;),
 (&#39;Buster&#39;, &#39;terrier&#39;, &#39;Louise&#39;),
 (&#39;T-Rex&#39;, &#39;iguana&#39;, &#39;Caleb&#39;)]
</pre></div>
</div>
</div>
</div>
</section>
<section id="connecting-to-other-rdbms">
<h2>Connecting to other RDBMS<a class="headerlink" href="#connecting-to-other-rdbms" title="Permalink to this headline">#</a></h2>
<p>Again, this is just an introduction of how to get data to/from a database we are using SQLite as a portable and simple example. All the same principals apply even if you are connecting to a Microsoft SQL, Teradata, Oracle or other DBMS. But the connection mechanism for other databases can vary.  There are a few common libraries we can leverage such as <a class="reference external" href="https://github.com/mkleehammer/pyodbc/wiki">pyodbc</a>.  <a class="reference external" href="https://docs.microsoft.com/en-us/sql/odbc/reference/what-is-odbc?view=sql-server-ver16">ODBC</a> is a specification for a database API.  Nearly every commercial RDBMS supports connections and transactions using ODBC, meaning that to change between one database and another, the code changes very little - typcially the only thing that needs to change in the connection string and the precise SQL you are trying to execute.  Though that doesn’t mean it is easy, connection strings are database platform dependent and can vary widely.  Here’s <a class="reference external" href="https://www.connectionstrings.com/">one source</a> that might help.</p>
<p>For SQL server, the connection string looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Driver=SQL Server Native Client 18.0;Server=myservername; Database=myDatabase; User Id=myUserName; Password=myPassword;TrustServerCertificate=Yes;&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Environment Variables
Environment variables are variables that are stored in the operating system, rather than in our program.  Environment variables provide a way to configure your application without having to edit your source code when the configuration changes. Common config items that are often passed to application through environment variables are third-party API keys, network ports, database servers, and any custom options that your application may need to work properly.  For more information on environment variables <a class="reference external" href="https://www.twilio.com/blog/environment-variables-python">see this fantastic resource</a>.</p>
<p>Additionally, the library I used here <a class="reference external" href="https://pypi.org/project/python-dotenv/"><code class="docutils literal notranslate"><span class="pre">python-dotenv</span></code></a> can get your environment from a <code class="docutils literal notranslate"><span class="pre">.env</span></code> file in root of your Python project.</p>
</div>
<section id="connecting-to-ms-sql-server">
<h3>Connecting to MS SQL Server<a class="headerlink" href="#connecting-to-ms-sql-server" title="Permalink to this headline">#</a></h3>
<p>Most of the major RDBMS providers also provide python specific libraries if you know that you wont have to switch between different databases.  For instance, Microsoft provides <a class="reference external" href="http://www.pymssql.org/">pymssql</a>.  Using one of these libraries tends to make things a bit simpler if you just want to be able to do simple queries with a SQL database.</p>
<p>For examples of connecting to a DB with ODBC see <a class="reference internal" href="../extras/252-SQL_ODBC.html"><span class="doc std std-doc">this notebook</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">getenv</span>
<span class="kn">import</span> <span class="nn">pymssql</span>

<span class="c1"># This library allows the environment variables to be loaded from a file</span>
<span class="n">load_dotenv</span><span class="p">()</span>

<span class="c1"># To get this working quickly, you can just replace these variables with your own values</span>
<span class="n">svr</span> <span class="o">=</span> <span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;PYMSSQL_SERVER&quot;</span><span class="p">)</span>
<span class="n">uid</span> <span class="o">=</span> <span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;PYMSSQL_USER&quot;</span><span class="p">)</span>
<span class="n">pwd</span> <span class="o">=</span> <span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;PYMSSQL_PASSWORD&quot;</span><span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;PYMSSQL_DATABASE&quot;</span><span class="p">)</span>


<span class="c1"># Connect to a MS SQL Server Database</span>
<span class="n">cnn</span> <span class="o">=</span> <span class="n">pymssql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">svr</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="n">uid</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">pwd</span><span class="p">,</span><span class="n">database</span><span class="o">=</span><span class="n">db</span><span class="p">)</span>

<span class="c1"># Create the cursor required to run the command</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">cnn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># Run the SQL command</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT top 10 * FROM Actor&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1, &#39;10, Mack&#39;)
(2, &#39;101, Highway&#39;)
(3, &#39;2, Kase&#39;)
(4, &#39;2Pac&#39;)
(5, &quot;4-Tay, Rappin&#39;&quot;)
(6, &#39;7, Marc&#39;)
(7, &#39;9mm, Orange&#39;)
(8, &#39;Aaliyah&#39;)
(9, &#39;Aames, Angela&#39;)
(10, &#39;Aames, Willie&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="dynamic-queries">
<h3>Dynamic Queries<a class="headerlink" href="#dynamic-queries" title="Permalink to this headline">#</a></h3>
<p>As soon as developers understand the value of using Python to connect to SQL the very next step is to put the two things together to create dynamic queries.  For instance look at the following code snippet.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">from</span> <span class="nn">dateutil.relativedelta</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">last_month</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">+</span><span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">month</span>
<span class="n">sql_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT * FROM sales WHERE month = </span><span class="si">{</span><span class="n">last_month</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># Connect to the database and do something interesting</span>
<span class="c1"># ...</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ellipsis
</pre></div>
</div>
</div>
</div>
<p>This is super handy, cause now we can get just the data we need like last month’s sales and export it to an Excel sheet.  Python of course is terrific at automating this kind of thing and when we combine with SQL, we get some really powerful automation.</p>
<p>Even better we could ask a user to give us a date and we can create a query from the response</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">month</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Which month should I get sales from?&#39;</span><span class="p">)</span>
<span class="n">sql_query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM sales WHERE month = &quot;</span><span class="o">+</span><span class="n">month</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Normally we would expect that users wouldn’t do anything malicious - they would input a month number and we’d have a perfectly fine query.  But we could run across a user that is less than friendly, they could input something like</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">sales</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>The resulting string would be</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">sales</span> <span class="n">WHERE</span> <span class="n">month</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">DROP</span> <span class="n">TABLE</span> <span class="n">sales</span><span class="p">;</span>
</pre></div>
</div>
<p>If this statement were executed by our program, we would inadvertantly end up losing our entire sales table!</p>
<section id="passing-parameters">
<h4>Passing parameters<a class="headerlink" href="#passing-parameters" title="Permalink to this headline">#</a></h4>
<p>Fortunately there is protection.  We can let the SQL parser handle any issues like this, ensuring that we only get valid values for our parameters and not malicious code like above.  We simply pass parameters to fill in the variable parts of our SQL statement.</p>
<p>In the next code snippet, we are going to use another database in the supplied data, <code class="docutils literal notranslate"><span class="pre">cereals.db</span></code>.  This database has nutrition data for a variety of cereals.  We’ll start by getting the columns that are in the database then we’ll move on to a query using parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Connect to a sample database</span>
<span class="n">cnn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;../data/cereals.db&#39;</span><span class="p">)</span>
<span class="n">cnn</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">cnn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select * from cereals&#39;</span><span class="p">)</span>
<span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">cnn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;index&#39;, &#39;name&#39;, &#39;mfr&#39;, &#39;type&#39;, &#39;calories&#39;, &#39;protein&#39;, &#39;fat&#39;, &#39;sodium&#39;, &#39;fiber&#39;, &#39;carbo&#39;, &#39;sugars&#39;, &#39;potass&#39;, &#39;vitamins&#39;, &#39;shelf&#39;, &#39;weight&#39;, &#39;cups&#39;, &#39;rating&#39;]
</pre></div>
</div>
</div>
</div>
<p>Now that we know the kind of data we have in the table, we can go ahead with build a query where the number of calories are limited.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cnn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;../data/cereals.db&#39;</span><span class="p">)</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">cnn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># Set the max_calories to be considered a low-calorie option</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Low calorie cereals&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
<span class="n">max_calories</span> <span class="o">=</span> <span class="mi">75</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT name,calories FROM cereals WHERE calories &lt;= ?&quot;</span><span class="p">,[</span><span class="n">max_calories</span><span class="p">])</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="c1"># Now, using the same query we can ask for high-calorie cereals</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;High calorie cereals&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
<span class="n">max_calories</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT name,calories FROM cereals WHERE calories &gt;= ?&quot;</span><span class="p">,[</span><span class="n">max_calories</span><span class="p">])</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">cnn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Low calorie cereals
----------
100%_Bran: 70
All-Bran: 70
All-Bran_with_Extra_Fiber: 50
Puffed_Rice: 50
Puffed_Wheat: 50

High calorie cereals
----------
Muesli_Raisins,_Dates,_&amp;_Almonds: 150
Muesli_Raisins,_Peaches,_&amp;_Pecans: 150
Mueslix_Crispy_Blend: 160
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="using-pandas">
<h2>Using pandas<a class="headerlink" href="#using-pandas" title="Permalink to this headline">#</a></h2>
<p>Using Python, we can depend on one of our favorite data management utility libraries, <code class="docutils literal notranslate"><span class="pre">pandas</span></code> to get and put data into a SQLite database.  This is great news, because we already know how to do alot of different tasks with our utility library pandas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;../data/laptopsales.db&#39;</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM sales&#39;</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;sale_id&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Configuration</th>
      <th>Customer Postcode</th>
      <th>Store Postcode</th>
      <th>Retail Price</th>
      <th>Screen Size (Inches)</th>
      <th>Battery Life (Hours)</th>
      <th>RAM (GB)</th>
      <th>Processor Speeds (GHz)</th>
      <th>Integrated Wireless?</th>
      <th>HD Size (GB)</th>
      <th>Bundled Applications?</th>
      <th>customer X</th>
      <th>customer Y</th>
      <th>store X</th>
      <th>store Y</th>
      <th>sale_date</th>
    </tr>
    <tr>
      <th>sale_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>163</td>
      <td>EC4V 5BH</td>
      <td>SE1 2BN</td>
      <td>455.0</td>
      <td>15</td>
      <td>5</td>
      <td>1</td>
      <td>2.0</td>
      <td>Yes</td>
      <td>80</td>
      <td>Yes</td>
      <td>532041</td>
      <td>180995</td>
      <td>534057.0</td>
      <td>179682.0</td>
      <td>2008-01-01 00:01:00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>320</td>
      <td>SW4 0JL</td>
      <td>SW12 9HD</td>
      <td>545.0</td>
      <td>15</td>
      <td>6</td>
      <td>1</td>
      <td>2.0</td>
      <td>No</td>
      <td>300</td>
      <td>No</td>
      <td>529240</td>
      <td>175537</td>
      <td>528739.0</td>
      <td>173080.0</td>
      <td>2008-01-01 00:02:00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>23</td>
      <td>EC3V 1LR</td>
      <td>E2 0RY</td>
      <td>515.0</td>
      <td>15</td>
      <td>4</td>
      <td>1</td>
      <td>2.0</td>
      <td>Yes</td>
      <td>300</td>
      <td>Yes</td>
      <td>533095</td>
      <td>181047</td>
      <td>535652.0</td>
      <td>182961.0</td>
      <td>2008-01-01 00:04:00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>169</td>
      <td>SW1P 3AU</td>
      <td>SE1 2BN</td>
      <td>395.0</td>
      <td>15</td>
      <td>5</td>
      <td>1</td>
      <td>2.0</td>
      <td>No</td>
      <td>40</td>
      <td>Yes</td>
      <td>529902</td>
      <td>179641</td>
      <td>534057.0</td>
      <td>179682.0</td>
      <td>2008-01-01 00:04:00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>365</td>
      <td>EC4V 4EG</td>
      <td>SW1V 4QQ</td>
      <td>585.0</td>
      <td>15</td>
      <td>6</td>
      <td>2</td>
      <td>2.0</td>
      <td>No</td>
      <td>120</td>
      <td>Yes</td>
      <td>531684</td>
      <td>180948</td>
      <td>528924.0</td>
      <td>178440.0</td>
      <td>2008-01-01 00:06:00</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>297567</th>
      <td>703</td>
      <td>SE1 2UP</td>
      <td>SW1P 3AU</td>
      <td>NaN</td>
      <td>17</td>
      <td>5</td>
      <td>4</td>
      <td>2.0</td>
      <td>No</td>
      <td>300</td>
      <td>Yes</td>
      <td>533595</td>
      <td>180025</td>
      <td>529902.0</td>
      <td>179641.0</td>
      <td>2008-12-30 23:55:00</td>
    </tr>
    <tr>
      <th>297568</th>
      <td>731</td>
      <td>N13 4JD</td>
      <td>N3 1DH</td>
      <td>392.0</td>
      <td>17</td>
      <td>6</td>
      <td>1</td>
      <td>1.5</td>
      <td>No</td>
      <td>80</td>
      <td>Yes</td>
      <td>531165</td>
      <td>192973</td>
      <td>525109.0</td>
      <td>190628.0</td>
      <td>2008-12-30 23:55:00</td>
    </tr>
    <tr>
      <th>297569</th>
      <td>375</td>
      <td>SE25 6EF</td>
      <td>CR7 8LE</td>
      <td>441.0</td>
      <td>15</td>
      <td>6</td>
      <td>2</td>
      <td>2.4</td>
      <td>Yes</td>
      <td>300</td>
      <td>Yes</td>
      <td>534086</td>
      <td>168521</td>
      <td>532714.0</td>
      <td>168302.0</td>
      <td>2008-12-30 23:57:00</td>
    </tr>
    <tr>
      <th>297570</th>
      <td>101</td>
      <td>SW8 1LA</td>
      <td>SW1P 3AU</td>
      <td>406.0</td>
      <td>15</td>
      <td>4</td>
      <td>4</td>
      <td>1.5</td>
      <td>Yes</td>
      <td>120</td>
      <td>Yes</td>
      <td>530716</td>
      <td>177488</td>
      <td>529902.0</td>
      <td>179641.0</td>
      <td>2008-12-30 23:58:00</td>
    </tr>
    <tr>
      <th>297571</th>
      <td>343</td>
      <td>SE16 4QZ</td>
      <td>SE8 3JD</td>
      <td>530.0</td>
      <td>15</td>
      <td>6</td>
      <td>2</td>
      <td>1.5</td>
      <td>Yes</td>
      <td>300</td>
      <td>Yes</td>
      <td>534348</td>
      <td>179162</td>
      <td>537175.0</td>
      <td>177885.0</td>
      <td>2008-12-30 23:58:00</td>
    </tr>
  </tbody>
</table>
<p>297572 rows × 16 columns</p>
</div></div></div>
</div>
<p>Likewise we can do some work with our dataframe and put it into a database with the <code class="docutils literal notranslate"><span class="pre">pd.to_sql()</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a pandas dataframe</span>
<span class="n">phone_book_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Name&#39;</span><span class="p">:[</span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span><span class="s1">&#39;Charlie&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Phone&#39;</span><span class="p">:[</span><span class="s1">&#39;555-555-1234&#39;</span><span class="p">,</span><span class="s1">&#39;123-456-7890&#39;</span><span class="p">,</span><span class="s1">&#39;555-867-5309&#39;</span><span class="p">]</span>
    <span class="p">})</span>
<span class="n">phone_book_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Phone</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alice</td>
      <td>555-555-1234</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Bob</td>
      <td>123-456-7890</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Charlie</td>
      <td>555-867-5309</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a connection to the sqlite3 database</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;../output/phone_book.db&#39;</span><span class="p">)</span>
<span class="c1"># This says to create a table named `phone_numbers` in the phone_book database.</span>
<span class="c1"># If the db or table is already there, replace it</span>
<span class="c1"># Don&#39;t store the index value in the db</span>
<span class="n">phone_book_df</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;phone_numbers&#39;</span><span class="p">,</span><span class="n">conn</span><span class="p">,</span><span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM phone_numbers&#39;</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Phone</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alice</td>
      <td>555-555-1234</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Bob</td>
      <td>123-456-7890</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Charlie</td>
      <td>555-867-5309</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Being able to connect to a SQL database and run queries from Python is super handy and really useful. Combining the simplicity of Python and the power of a relational database can make for some very compelling and useful automation of common tasks.  Using <code class="docutils literal notranslate"><span class="pre">pandas</span></code> is especially handy because once we create the connection to the database - the rest of the logic flows without concerning about specific SQL syntax.  So, we could just as easily execute the last few operations with a MS SQL server connection, a SQLite connection or on a CSV file.</p>
<div class="highlight-{caution}:::: notranslate"><div class="highlight"><pre><span></span>Using pandas dataframes with relational databases is a bit limiting beyond simply gathering and pushing data.  The only two supported approaches are SQLite3 and using the Object Relational Mapping connection provided by [SQLAlchemy](https://www.sqlalchemy.org/).  There is an example of connecting to a SQL server using this kind of approach in [this notebook](../extras/251-SQL_Alchemy.ipynb).
</pre></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./book/lessons"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="240-Getting_Web_Data.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Gather data from the web</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="260-Data_Visualization.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Exploratory Data Analysis</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Michael Dereszynski<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>